---
title: "[Web] ê³ ê° êµ¬ë§¤ ì˜ˆì¸¡"
date: 2025-03-12 14:00:00 +09:00
categories: [GM, Web Service]
tags:
  [
    GM,
    ê·¸ë¡œìŠ¤ë§ˆì¼€íŒ…,
    ë¡œì§€ìŠ¤í‹±,
    íšŒê·€ë¶„ì„,
    K-NN,
    ì•Œê³ ë¦¬ì¦˜
  ]
---

# **ğŸ‘”K-NN ì•Œê³ ë¦¬ì¦˜ ì´ìš©í•œ ì˜ë¥˜ìƒí’ˆ ì¶”ì²œ ì›¹ì‚¬ì´íŠ¸**

ì‹ ê·œê³ ê°ì— ëŒ€í•œ ì˜ë¥˜ìƒí’ˆ ì¶”ì²œì´ ê°€ëŠ¥í•˜ë„ë¡ Flaskë¥¼ í™œìš©í•´ Web serviceë¥¼ êµ¬ì¶•í•´ ë³´ê² ë‹¤.  
Datasetì€ ê³ ê°ë“¤ì˜ ì˜ë¥˜ êµ¬ë§¤ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì˜€ë‹¤. â¡ï¸[sales.csv](https://github.com/Zihyeoni/GM/tree/main/%EC%8B%A4%EC%8A%B5DataFile)

**sales.csv**  
![Image](https://github.com/user-attachments/assets/7fb802df-32bf-464b-8b40-45132c40acdb)

**Directory êµ¬ì¡°**  
![Image](https://github.com/user-attachments/assets/65038293-c902-404a-9ab8-347c9f40c4ff)

**app.py**  
```python
from flask import Flask, request, render_template
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.neighbors import KNeighborsClassifier

app = Flask(__name__)

# ë°ì´í„°ì…‹ ë¡œë“œ
file_path = 'sales.csv'
df = pd.read_csv(file_path)

# 'PurchaseAmount (ì›)' ì»¬ëŸ¼ëª…ì„ 'PurchaseAmount'ë¡œ ë³€ê²½
df.rename(columns={'PurchaseAmount (ì›)': 'PurchaseAmount'}, inplace=True)

# í•„ìš”í•œ ë°ì´í„° ì „ì²˜ë¦¬
X = df[['Age', 'Gender', 'ClothingCategory', 'Brand', 'PurchaseAmount']]  # í•„ìš”í•œ íŠ¹ì„±ë§Œ ì„ íƒ
y = df['Email']  # íƒ€ê²Ÿ ë³€ìˆ˜ (Email)

# ë²”ì£¼í˜• ë°ì´í„°ë¥¼ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜
X = pd.get_dummies(X)

# ë°ì´í„°ì…‹ì„ í•™ìŠµê³¼ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ë¡œ ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# K-NN ëª¨ë¸ í•™ìŠµ
knn = KNeighborsClassifier(n_neighbors=3)
knn.fit(X_train, y_train)

# ë“œë¡­ë‹¤ìš´ ì˜µì…˜ì„ ìœ„í•œ ê³ ìœ  ê°’ ì¶”ì¶œ
gender_options = df['Gender'].unique().tolist()
clothing_category_options = df['ClothingCategory'].unique().tolist()
brand_options = df['Brand'].unique().tolist()

@app.route('/')
def index():
    return render_template('index.html', 
                           gender_options=gender_options, 
                           clothing_category_options=clothing_category_options, 
                           brand_options=brand_options)

@app.route('/predict', methods=['POST'])
def predict_customer():
    if request.method == 'POST':
        # í¼ì—ì„œ ì…ë ¥ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
        age = int(request.form['age'])
        gender = request.form['gender']
        clothing_category = request.form['clothing_category']
        brand = request.form['brand']
        purchase_amount = int(request.form['purchase_amount'])

        # ìƒˆë¡œìš´ ê³ ê° ë°ì´í„° í”„ë ˆì„ ìƒì„±
        new_customer = pd.DataFrame({
            'Age': [age],
            'Gender': [gender],
            'ClothingCategory': [clothing_category],
            'Brand': [brand],
            'PurchaseAmount': [purchase_amount]
        })

        # ìƒˆë¡œìš´ ê³ ê° ë°ì´í„°ì— ëŒ€í•´ One-Hot Encoding ì ìš©
        new_customer = pd.get_dummies(new_customer)
        new_customer = new_customer.reindex(columns=X.columns, fill_value=0)

        # ê°€ì¥ ìœ ì‚¬í•œ ê³ ê°ì˜ Email ì˜ˆì¸¡
        predicted_customer = knn.predict(new_customer)[0]

        # ìœ ì‚¬í•œ ê³ ê°ì˜ êµ¬ë§¤ íŒ¨í„´ í™•ì¸ ë° ì¶”ì²œ
        similar_customers = df[df['Email'] == predicted_customer]
        if not similar_customers.empty:
            input_amount = new_customer['PurchaseAmount'].values[0]

            # ì…ë ¥ ê¸ˆì•¡ê³¼ ê°€ì¥ ìœ ì‚¬í•œ ìƒí’ˆì„ ì°¾ê¸° ìœ„í•´ ì˜¤ì°¨ë¥¼ ê³„ì‚°
            df['AmountDifference'] = abs(df['PurchaseAmount'] - input_amount)

            # ì˜¤ì°¨ê°€ ì‘ì€ ìƒí’ˆì„ ì¶”ì²œ (ì—¬ê¸°ì„œëŠ” ìƒìœ„ 5ê°œì˜ ìœ ì‚¬í•œ ìƒí’ˆì„ ì¶”ì²œ)
            recommended_products = df.nsmallest(5, 'AmountDifference')

            return render_template('result.html', 
                                   predicted_email=predicted_customer, 
                                   recommendations=recommended_products[['Brand', 'ClothingCategory', 'PurchaseAmount', 'PurchaseLocation']].to_html(index=False))
        else:
            return render_template('result.html', predicted_email=predicted_customer, recommendations=None)

    return render_template('index.html')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5001, debug=True)
```

**templates/index.html**  
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê° êµ¬ë§¤ ì˜ˆì¸¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #444;
        }
        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        input[type="submit"] {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        input[type="submit"]:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ê³ ê° êµ¬ë§¤ ì˜ˆì¸¡</h1>
        <form action="/predict" method="post">
            <label for="age">ë‚˜ì´:</label>
            <input type="number" id="age" name="age" required>

            <label for="gender">ì„±ë³„:</label>
            <select id="gender" name="gender" required>
                {% for option in gender_options %}
                <option value="{{ option }}">{{ option }}</option>
                {% endfor %}
            </select>

            <label for="clothing_category">ì˜ë¥˜ ì¹´í…Œê³ ë¦¬:</label>
            <select id="clothing_category" name="clothing_category" required>
                {% for option in clothing_category_options %}
                <option value="{{ option }}">{{ option }}</option>
                {% endfor %}
            </select>

            <label for="brand">ë¸Œëœë“œ:</label>
            <select id="brand" name="brand" required>
                {% for option in brand_options %}
                <option value="{{ option }}">{{ option }}</option>
                {% endfor %}
            </select>

            <label for="purchase_amount">êµ¬ë§¤ ê¸ˆì•¡ (ì›):</label>
            <input type="number" id="purchase_amount" name="purchase_amount" required>

            <input type="submit" value="ì˜ˆì¸¡í•˜ê¸°">
        </form>
    </div>
</body>
</html>
```

**templates/result.html**  
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì¸¡ ê²°ê³¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #444;
        }
        h2 {
            color: #444;
            margin-top: 20px;
        }
        p {
            font-size: 16px;
            line-height: 1.5;
        }
        .recommendations {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        a {
            display: block;
            text-align: center;
            margin-top: 20px;
            text-decoration: none;
            color: #007BFF;
            font-weight: bold;
        }
        a:hover {
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì˜ˆì¸¡ ê²°ê³¼</h1>
        {% if recommendations %}
            <h2>ì¶”ì²œ ìƒí’ˆ:</h2>
            <div class="recommendations">
                {{ recommendations | safe }}
            </div>
            <p>ê³ ê°ë‹˜ì˜ êµ¬ë§¤ ê¸ˆì•¡ì„ ë°”íƒ•ìœ¼ë¡œ ìœ ì‚¬í•œ ìƒí’ˆì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤!</p>
        {% else %}
            <p>ì•ˆíƒ€ê¹ê²Œë„ ì¶”ì²œí•  ìœ ì‚¬í•œ ìƒí’ˆì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
        {% endif %}
        <a href="/">ë‹¤ë¥¸ ê³ ê° ì˜ˆì¸¡í•˜ê¸°</a>
    </div>
</body>
</html>
```

VM ì ‘ì†  
![Image](https://github.com/user-attachments/assets/09427b1a-7c78-4fa1-80b5-8dfc3a140ff1)

Flask ì›ê²© ì„œë²„ì— ì €ì¥  
![Image](https://github.com/user-attachments/assets/50675fee-4712-4d28-bf69-c312624206c8)

python ì‹¤í–‰  
![Image](https://github.com/user-attachments/assets/588e105c-47f4-487d-97b2-19bde91b67c5)

VMì˜ ì™¸ë¶€ IPë¡œ ì›¹ì‚¬ì´íŠ¸ ì ‘ì† (í¬íŠ¸ 5001)  
![Image](https://github.com/user-attachments/assets/5d402cf4-9ce4-44e6-9810-6142047294d2)

<span style="background-color: #F7DDBE;">ê³ ê° êµ¬ë§¤ ì˜ˆì¸¡ !</span>  
![Image](https://github.com/user-attachments/assets/2a13e7ff-56dc-4c95-a418-81e355042928) ![Image](https://github.com/user-attachments/assets/74253c7e-bed9-4fea-afd4-c5db059e3c6c)