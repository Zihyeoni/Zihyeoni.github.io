---
title: "[Web] ê³ ê° ì¶©ì„±ë„ ë“±ê¸‰ ì˜ˆì¸¡"
date: 2025-03-12 17:00:00 +09:00
categories: [GM, Web Service]
tags:
  [
    GM,
    ê·¸ë¡œìŠ¤ë§ˆì¼€íŒ…,
    ë¡œì§€ìŠ¤í‹±,
    íšŒê·€ë¶„ì„,
    ë‹¤ì¤‘ í´ë˜ìŠ¤
  ]
---

# **ğŸ›ï¸ê³ ê° ì¶©ì„±ë„ ë“±ê¸‰ ì˜ˆì¸¡ ì›¹ì‚¬ì´íŠ¸**

ê³ ê°ì˜ ì¶©ì„±ë„ ì˜ˆì¸¡ì´ ê°€ëŠ¥í•˜ë„ë¡ Flaskë¥¼ í™œìš©í•´ Web serviceë¥¼ êµ¬ì¶•í•´ ë³´ê² ë‹¤.

**ê³ ê° ì¶©ì„±ë„ ë“±ê¸‰**  

| 0 (ë‚®ìŒ) | êµ¬ë§¤ ë¹ˆë„ê°€ ë‚®ê³ , ì¬ë°©ë¬¸ ê°€ëŠ¥ì„± ë‚®ìŒ |
| 1 (ì¤‘ê°„) | ì¼ì • ìˆ˜ì¤€ì˜ êµ¬ë§¤ì™€ ì¬ë°©ë¬¸ ê¸°ë¡ì´ ìˆìŒ |
| 2 (ë†’ìŒ) | ë†’ì€ êµ¬ë§¤ ë¹ˆë„ì™€ ì¶©ì„±ë„ë¥¼ ë³´ì´ë©°, ì¥ê¸° ê³ ê°ì´ ë  ê°€ëŠ¥ì„± í¼ |

**Directory êµ¬ì¡°**  
![Image](https://github.com/user-attachments/assets/62d38cb5-defb-4503-8142-86f6dad0226f)

**DataFrame**  
![Image](https://github.com/user-attachments/assets/85355be8-3a17-45ed-ba4d-b702cc19a5cd)

**app.py**  
```python
from flask import Flask, request, jsonify, render_template
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression

app = Flask(__name__)

# ê°€ìƒì˜ ê³ ê° ë°ì´í„° ìƒì„±
data = {
    'age': [22, 45, 25, 33, 50, 41, 29, 39, 48, 23, 31, 36, 27, 40, 53, 44, 26, 38, 51, 30],
    'monthly_purchases': [1, 5, 2, 3, 6, 4, 2, 3, 5, 1, 3, 4, 2, 4, 6, 5, 2, 3, 5, 2],
    'monthly_spending': [50, 300, 80, 200, 400, 250, 100, 220, 380, 60, 180, 240, 90, 270, 420, 320, 75, 230, 390, 110],
    'customer_support_calls': [3, 1, 4, 2, 0, 1, 3, 2, 0, 4, 2, 1, 3, 1, 0, 1, 4, 2, 0, 3],
    'loyalty_level': [0, 2, 0, 1, 2, 1, 0, 1, 2, 0, 1, 1, 0, 1, 2, 1, 0, 1, 2, 0]  # 0=ë‚®ìŒ, 1=ì¤‘ê°„, 2=ë†’ìŒ
}

df = pd.DataFrame(data)

# ë°ì´í„° ë¶„í• 
X = df[['age', 'monthly_purchases', 'monthly_spending', 'customer_support_calls']]
y = df['loyalty_level']

# í•™ìŠµ ë° í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)

# ë°ì´í„° ì •ê·œí™”
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

# ë¡œì§€ìŠ¤í‹± íšŒê·€ ëª¨ë¸ í•™ìŠµ
model = LogisticRegression(multi_class='multinomial', solver='lbfgs', max_iter=200)
model.fit(X_train, y_train)

@app.route('/')
def home():
    return render_template('index.html')

@app.route('/predict', methods=['POST'])
def predict():
    try:
        # í¼ì—ì„œ ë°›ì€ ë°ì´í„°
        age = float(request.form['age'])
        monthly_purchases = float(request.form['monthly_purchases'])
        monthly_spending = float(request.form['monthly_spending'])
        customer_support_calls = float(request.form['customer_support_calls'])

        # ì…ë ¥ ë°ì´í„° ë³€í™˜ ë° ì˜ˆì¸¡
        input_data = np.array([[age, monthly_purchases, monthly_spending, customer_support_calls]])
        input_scaled = scaler.transform(input_data)
        predicted_class = model.predict(input_scaled)[0]
        predicted_proba = model.predict_proba(input_scaled)[0]

        loyalty_labels = {0: "ë‚®ìŒ", 1: "ì¤‘ê°„", 2: "ë†’ìŒ"}
        result = {
            "predicted_class": loyalty_labels[predicted_class],
            "probabilities": {
                "ë‚®ìŒ": round(predicted_proba[0], 2),
                "ì¤‘ê°„": round(predicted_proba[1], 2),
                "ë†’ìŒ": round(predicted_proba[2], 2)
            }
        }

        return jsonify(result)

    except Exception as e:
        return jsonify({"error": str(e)})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5001, debug=True)
```

**templates/index.html**  
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê° ì¶©ì„±ë„ ì˜ˆì¸¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: auto;
        }
        input, button {
            width: 90%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .result {
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>ê³ ê° ì¶©ì„±ë„ ì˜ˆì¸¡</h2>
        <form id="predict-form">
            <label>ë‚˜ì´:</label>
            <input type="number" id="age" name="age" required>

            <label>ì›” í‰ê·  êµ¬ë§¤ íšŸìˆ˜:</label>
            <input type="number" id="monthly_purchases" name="monthly_purchases" required>

            <label>ì›” í‰ê·  ì§€ì¶œ ê¸ˆì•¡:</label>
            <input type="number" id="monthly_spending" name="monthly_spending" required>

            <label>ê³ ê° ì„œë¹„ìŠ¤ ë¬¸ì˜ íšŸìˆ˜:</label>
            <input type="number" id="customer_support_calls" name="customer_support_calls" required>

            <button type="submit">ì˜ˆì¸¡í•˜ê¸°</button>
        </form>

        <div class="result" id="result"></div>
    </div>

    <script>
        document.getElementById("predict-form").addEventListener("submit", function(event) {
            event.preventDefault();

            let formData = new FormData(this);

            fetch("/predict", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById("result").innerHTML = `<p style="color: red;">ì˜¤ë¥˜ ë°œìƒ: ${data.error}</p>`;
                } else {
                    document.getElementById("result").innerHTML = `
                        <p>ì˜ˆì¸¡ëœ ê³ ê° ì¶©ì„±ë„: <strong>${data.predicted_class}</strong></p>
                        <p>ë‚®ìŒ: ${data.probabilities.ë‚®ìŒ}</p>
                        <p>ì¤‘ê°„: ${data.probabilities.ì¤‘ê°„}</p>
                        <p>ë†’ìŒ: ${data.probabilities.ë†’ìŒ}</p>
                    `;
                }
            })
            .catch(error => {
                document.getElementById("result").innerHTML = `<p style="color: red;">API í˜¸ì¶œ ì˜¤ë¥˜: ${error}</p>`;
            });
        });
    </script>

</body>
</html>

```

VM ì ‘ì†  
![Image](https://github.com/user-attachments/assets/62c7993a-339a-4a6b-975a-3d6e194de414)

Flask ì›ê²© ì„œë²„ì— ì €ì¥  
![Image](https://github.com/user-attachments/assets/26173059-0897-444c-89de-0544e6f39cc6)

python ì‹¤í–‰  
![Image](https://github.com/user-attachments/assets/60893da7-0a7b-4ff2-866e-28268f2a1a88)

VMì˜ ì™¸ë¶€ IPë¡œ ì›¹ì‚¬ì´íŠ¸ ì ‘ì† (í¬íŠ¸ 5001)  
![Image](https://github.com/user-attachments/assets/a60d6c52-545a-423b-b7a3-2841760e6a19)

<span style="background-color: #F7DDBE;">ê³ ê° ì¶©ì„±ë„ ë“±ê¸‰ ì˜ˆì¸¡ !</span>  
![Image](https://github.com/user-attachments/assets/24f67280-d43f-4413-b633-1ecbbd6f9d75)